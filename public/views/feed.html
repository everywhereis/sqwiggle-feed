
<section ng-controller="FeedController" ng-init="getMessages(); getUsers()">
	<div id="layout" ng-class="menuactive ? 'active' :''">
		<!-- Menu toggle -->
		<a id="menuLink" class="menu-link" ng-class="menuactive ? 'active' :''" ng-click="togglemenu()">
			<!-- Hamburger icon -->
			<span></span>
		</a>
		<div id="menu" ng-class="menuactive ? 'active' :''">
			<div class="pure-menu pure-menu-open">
				<ul ng-repeat="user in users">
					<li class="menu-item-divided " ng-if="user.status == 'offline'" ><a><div class="indicator offline"></div> <span>{{user.name}}</span></a></li>
					<li class="menu-item-divided " ng-if="user.status == 'available'" ><a><div class="indicator available"></div> <span>{{user.name}}</span></a></li>
					<li class="menu-item-divided " ng-if="user.status == 'busy'" ><a><div class="indicator busy"></div> <span>{{user.name}}</span></a></li>
				</ul>
			</div>
		</div>
		<div id="main">
			<div class="header">
				<h1>Sqwiggle Feed</h1>
				<h2 ng-init="getRooms()" ng-cloak>{{room.name}}</h2>
			</div>
			
			<!-- SHOW DATA FROM INPUTS AS THEY ARE BEING TYPED -->
			<div class="content" infinite-scroll="loadMore()" infinite-scroll-immediate-check="false">
			<!-- FORM -->
				<form ng-submit="postMessage()">					
					<!-- SUPERHERO NAME -->
					<div id="superhero-group" class="pure-form"> 
						<fieldset>
						<!-- SUBMIT BUTTON -->
							<input type="text" name="text" class="pure-input-1" placeholder="Post to the swiggle chat" ng-model="formData.text">
							<button type="submit" class="btn btn-success btn-lg btn-block pure-button pure-input-1 pure-button-primary">
							 Submit
							</button>
						</fieldset>
					</div>
				</form>
				<div class="pure-form">
				<!-- Messages -->
				<div ng-repeat="message in messages" ng-if="message.text != ''"> 
					<!-- Avatar - Name -->
					<div id="nm" ng-if="message.text" >
						<img class="avatar" ng-src={{message.author.avatar}} alt="avatar" />
						{{message.author.name}}
					</div>
					<!-- Messages Text -->
					<div id="msg" ng-if="message.type=='message'">
						{{message.text}}
						<div ng-if="message.attachments"> 
							<a href={{message.attachments[0].url}} ><div class="attachment">
									<div class="attachment_image" ng-if="message.attachments[0].image">
										<img ng-src={{message.attachments[0].image}} />
									</div>
									<div class="attachment_title">
										{{message.attachments[0].title}}
									</div>
									<div class="attachment_desciption">
										{{message.attachments[0].description}}
										<span></span>
									</div>
								</div>
							</a>
						</div>
						<div class="clear"></div>
							<div class="timestamp" am-time-ago="message.created_at"  ></div>
						<div class="clear"></div>
					</div> 
					<!-- Conversation Text -->
					<div ng-if="message.conversation">
						<div id="convomsg">
						Conversation {{message.conversation.status}} between
							<div style="height: 2.5em;" >
								<img class="avatar" ng-src={{participants.avatar}} alt="avatar" ng-repeat="participants in message.conversation.participated"  />
							</div>
							<div class="clear"></div>
								<div class="timestamp" am-time-ago="message.created_at" ></div>
							<div class="clear"></div>	
						</div>
					</div>
					<!-- Github Text -->
					<div ng-if="message.type=='html'" >
						<div id="apimsg">
							<div ng-bind-html="message.text | unsafe"></div>
							<div class="clear"></div>
								<div class="timestamp" am-time-ago="message.created_at" ></div>
							<div class="clear"></div>
						</div>
						
					</div>
					
				</div>
			</div>
		</div>
	</div>
</section>